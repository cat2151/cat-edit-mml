# issue ym2151-log-play-server の新たな仕様に基づいて、serverを起動できるようにする #8
[issues #8](https://github.com/cat2151/cat-edit-mml/issues/8)

## 参考
https://github.com/cat2151/ym2151-log-play-server/pull/39

## 実装内容

### ym2151-log-play-server PR#39 の変更内容
サーバー起動時の仕様が以下のように変更されました：
- **変更前**: `ym2151-log-play-server --server output_ym2151.json` (起動時にJSONファイル必須)
- **変更後**: `ym2151-log-play-server --server` (待機状態で起動、JSONはクライアントから送信)

### cat-edit-mml の実装変更

#### 1. 起動時のサーバーチェック
- `App::new()`で`MmlProcessor::ensure_server_running()`を呼び出し
- サーバーが起動していない場合、`cat-play-mml --server`を起動
- デタッチモードで起動し、バックグラウンドで動作

#### 2. 演奏機能の実装
- MML → SMF → YM2151 JSON 変換を実装
- `send_json_direct()`を使用（4KB未満のJSON）
- `send_json_via_file()`を使用（4KB以上のJSON）
- レスポンス改善のため、直接JSONを送信

#### 3. プラットフォーム対応
- Windows: 完全機能（サーバー起動、直接演奏）
- Linux/その他: エディタは動作、演奏は警告メッセージ

### 依存関係の追加
- `mmlabc-to-smf`: MMLからSMFへの変換
- `smf-to-ym2151log-rust`: SMFからYM2151ログへの変換
- `ym2151-log-play-server`: サーバーとの通信
- `serde_json`: JSON処理

### 検証結果
- ✅ ビルド成功（debug/release）
- ✅ テスト成功 (9/9 テスト合格)
- ✅ 依存関係の確認完了
- ✅ プラットフォーム固有の機能を適切に分離

### コミット
- d7f0f2a: サーバー起動と直接JSON再生の実装

