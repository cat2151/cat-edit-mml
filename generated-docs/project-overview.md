Last updated: 2025-11-17

# Project Overview

## プロジェクト概要
- Rustで開発された、MML（Music Macro Language）用のTUI（テキストユーザーインターフェース）エディタです。
- MMLの記述と同時に、入力した音符を自動再生し、即座に確認できるミニマムな作曲体験を提供します。
- 複数行テキスト編集、MMLテンプレート、再生モード切り替えなど、MML作成をサポートする機能が充実しています。

## 技術スタック
- フロントエンド:
    - `ratatui`: Rust製のターミナルユーザーインターフェース (TUI) フレームワークで、複雑なUIを効率的に描画します。
    - `tui-textarea`: `ratatui`上で動作する複数行テキスト入力ウィジェットで、高度なテキスト編集機能を提供します。
    - `crossterm`: クロスプラットフォーム対応のターミナル操作ライブラリで、カーソル制御やキーイベント処理などを実現します。
- 音楽・オーディオ:
    - `cat-play-mml`: MMLを解析しオーディオとして再生するための外部ツール（子プロセスとして呼び出し）。Nuked-OPMエンジンを利用し、MMLの自動再生機能の中核を担います（Windows専用）。
- 開発ツール:
    - `Cargo`: Rustの公式なビルドシステムおよびパッケージマネージャーで、依存関係の管理、プロジェクトのビルド、テスト実行に使用されます。
- 言語機能:
    - `Rust`: 高速性、安全性、並行性を重視したシステムプログラミング言語で、本プロジェクトの基盤となっています。バージョン1.70以降が使用されています。
- テスト:
    - `cargo test`: Rustの組み込みテストランナーで、プロジェクト内のユニットテストや統合テストを実行するために使用されます。
- ビルドツール:
    - `Cargo`: (開発ツールと共通) Rustプロジェクトのビルドプロセスを管理し、実行可能なバイナリを生成します。

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.md
📄 _config.yml
📁 generated-docs/
📁 issue-notes/
  📖 10.md
  📖 6.md
  📖 8.md
📁 src/
  📄 app.rs
  📄 event.rs
  📄 lib.rs
  📄 main.rs
  📄 mml.rs
  📄 template.rs
  📄 ui.rs
```

## ファイル詳細説明
- `.gitignore`: Gitのバージョン管理システムで無視するファイルやディレクトリのパターンを定義します。
- `Cargo.lock`: プロジェクトの依存関係ツリーの正確なバージョンを記録し、再現可能なビルドを保証します。
- `Cargo.toml`: Rustプロジェクトのマニフェストファイル。プロジェクト名、バージョン、依存クレート、ビルド設定などを記述します。
- `LICENSE`: プロジェクトのライセンス情報（MIT License）を記載しています。
- `README.md`: プロジェクトの概要、機能、インストール方法、使用方法、キーボード操作などの主要な情報を提供します。
- `_config.yml`: GitHub Pagesなどの静的サイトジェネレーターの設定ファイルとして使用される可能性があります。
- `generated-docs/`: 自動生成されたドキュメントやレポートが格納されることを意図したディレクトリです。
- `issue-notes/`: 開発中の課題、検討事項、特定のイシューに関するメモをMarkdown形式で記録しているディレクトリです。
- `src/`: プロジェクトのソースコードが格納されている主要なディレクトリです。
    - `src/app.rs`: アプリケーションの全体的な状態管理、メインロジック、イベント処理の中核を担うモジュールです。TUIアプリケーションの主要な動作フローを定義します。
    - `src/event.rs`: ユーザーからのキーボード入力イベントや、`cat-play-mml`のような外部プロセスからのイベントを処理・管理するモジュールです。
    - `src/lib.rs`: プロジェクトがライブラリとして使用される場合の公開インターフェースを定義したり、`main.rs`で共有される共通のロジックやデータ構造を保持したりします。
    - `src/main.rs`: プログラムのエントリーポイント。アプリケーションの初期化、イベントループの開始、`app`や`ui`モジュールとの連携を行います。
    - `src/mml.rs`: Music Macro Language (MML) 固有のロジックを扱います。MMLテキストの解析、特定の音符の検出、`cat-play-mml`コマンドの生成、再生モードの管理などが含まれます。
    - `src/template.rs`: MMLテンプレート機能に関するロジックを管理します。複数のMMLテンプレートの定義、F2キーによる切り替え処理、現在のテンプレート状態の保持などを担当します。
    - `src/ui.rs`: ターミナルユーザーインターフェース (TUI) の描画ロジックを担当します。`ratatui`や`tui-textarea`クレートを使用して、エディタ画面、タイトルバー、MML表示エリアなどのUI要素を構築します。

## 関数詳細説明
このプロジェクトはRustで記述されており、以下のような主要な処理単位が関数として実装されていると推測されます。具体的な関数名や引数はプロジェクト情報から特定できませんが、一般的なTUIアプリケーションの構造に基づいて役割を説明します。

- **アプリケーション初期化関数**:
    - 役割: ターミナルの初期設定、TUIのセットアップ、アプリケーションの状態オブジェクトの生成を行います。
    - 機能: クロスタームのイベントリスナーを開始し、初期画面を描画可能な状態にします。
- **イベントループ関数**:
    - 役割: アプリケーションのメインループを管理し、ユーザー入力やシステムイベントを継続的に監視・処理します。
    - 機能: キーイベントを検出し、それに応じてアプリケーションの状態を更新したり、UIを再描画したりする処理を呼び出します。
- **UI描画関数**:
    - 役割: 現在のアプリケーションの状態に基づいて、ターミナル上にユーザーインターフェースを描画します。
    - 機能: エディタのテキストエリア、ステータスバー、タイトルバー、再生モード表示など、画面上のすべての要素を再構築し、最新の状態を反映させます。
- **キーイベント処理関数**:
    - 役割: ユーザーが押したキーに応じて適切なアクションを実行します。
    - 機能: カーソル移動、テキスト挿入・削除、MMLテンプレート切り替え（F2）、再生モード切り替え（Ctrl+P）、アプリケーション終了（ESC）などの操作を処理します。
- **テキスト編集関数**:
    - 役割: エディタ内のテキストコンテンツを操作します。
    - 機能: テキストの挿入、削除、バックスペース、改行、カーソル位置の管理など、基本的なテキスト編集ロジックを提供します。
- **MML再生制御関数**:
    - 役割: MMLの自動再生機能を管理し、`cat-play-mml`プロセスとの連携を行います。
    - 機能: MMLノートの入力検出、再生モードに応じたMMLコンテンツの抽出、`cat-play-mml`へのコマンド送信、再生プロセスの起動と管理、インストール処理のハンドリングを行います。
- **MMLテンプレート管理関数**:
    - 役割: MMLテンプレートの切り替えと適用を制御します。
    - 機能: F2キーが押された際に、定義されたテンプレートリストから次のテンプレートを選択し、エディタのテキストエリアに適用します。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした。

---
Generated at: 2025-11-17 07:07:21 JST
