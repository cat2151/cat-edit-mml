Last updated: 2025-11-12

# Project Overview

## プロジェクト概要
- Rustで構築された、MML（Music Macro Language）用のテキストベースのユーザーインターフェース（TUI）エディタです。
- MMLノート入力時の自動再生機能と、便利なMMLテンプレート切り替え機能を備えています。
- コマンドラインからシンプルかつ素早くMMLを編集し、その場で音を鳴らす体験を提供することを目指しています。

## 技術スタック
- フロントエンド: 
  - **ratatui**: Rust製の堅牢なTUIフレームワークで、このエディタのユーザーインターフェースの基盤となっています。
  - **tui-textarea**: ratatui上で動作する、複数行のテキスト入力と編集機能を提供するウィジェットです。
  - **crossterm**: クロスプラットフォームで端末操作（キー入力、カーソル制御など）を可能にするライブラリです。
- 音楽・オーディオ: 
  - **cat-play-mml**: MMLを解析し、オーディオを再生する外部ツールです。本プロジェクトでは、MMLノート入力時に子プロセスとしてこのツールを呼び出し、自動再生を実現しています。
- 開発ツール: 
  - **Rust**: 高性能で安全なアプリケーション開発に適したプログラミング言語です。
  - **Cargo**: Rustプロジェクトのビルドシステムおよびパッケージマネージャーで、依存関係の管理とビルドを効率化します。
- テスト: 
  - **Cargo test**: Rustに標準で付属するテストフレームワークで、コードの品質と安定性を保証するための単体テストや統合テストの実行に利用されます。
- ビルドツール: 
  - **Cargo**: プロジェクトのコンパイル、実行、テスト、パッケージングなど、開発ライフサイクル全般を管理するツールです。
- 言語機能: 
  - **Rust**: メモリ安全性、強力な型システム、並行処理サポートなど、堅牢なアプリケーション開発に貢献する様々な言語機能が活用されています。
- 自動化・CI/CD: (情報なし)
- 開発標準: (情報なし)

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.md
📄 _config.yml
📁 generated-docs/
📁 src/
  📄 app.rs
  📄 event.rs
  📄 lib.rs
  📄 main.rs
  📄 mml.rs
  📄 template.rs
  📄 ui.rs
```

## ファイル詳細説明
- **.gitignore**: Gitバージョン管理システムにおいて、追跡対象から除外するファイルやディレクトリを指定します。
- **Cargo.lock**: Cargo.tomlに記述された依存関係の具体的なバージョン情報を記録し、再現可能なビルドを保証します。
- **Cargo.toml**: Rustプロジェクトの設定ファイルで、プロジェクト名、バージョン、依存クレート（ライブラリ）などを定義します。
- **LICENSE**: プロジェクトのライセンス情報（MIT License）を記述したファイルです。
- **README.md**: プロジェクトの概要、機能、使用技術、インストール方法、使い方などが詳細に説明されています。
- **_config.yml**: GitHub Pagesなどの静的サイトジェネレータで使用される設定ファイルです。
- **generated-docs/**: プロジェクトのドキュメントが生成され、格納されるディレクトリです。
- **src/**: プロジェクトの主要なソースコードが格納されているディレクトリです。
  - **app.rs**: アプリケーションのコアロジック、状態管理、イベント処理のほとんどを担うモジュールです。TUIエディタの振る舞いを定義します。
  - **event.rs**: ユーザーからのキー入力などのイベントを捕捉・処理するためのロジックを管理するモジュールです。
  - **lib.rs**: このプロジェクトがライブラリとして提供される場合のルートファイルです。他のモジュールを公開し、再利用可能なコンポーネントを定義します。
  - **main.rs**: 実行可能アプリケーションのエントリーポイント（開始点）となるファイルです。アプリケーションの初期化とメインループの実行を担当します。
  - **mml.rs**: MMLの自動再生機能に関連するロジックを実装するモジュールです。`cat-play-mml`の起動・制御やインストール処理を含みます。
  - **template.rs**: MMLテンプレートの定義、管理、そしてF2キーでの切り替えロジックを提供するモジュールです。
  - **ui.rs**: ユーザーインターフェース（TUI）の描画ロジックを定義するモジュールです。画面上のテキストエリアやステータスバーなどの表示を担当します。

## 関数詳細説明
- **`main()`**: アプリケーションのエントリーポイントです。初期設定を行い、アプリケーションのメインループを開始します。
- **`App::new()`**: アプリケーションの状態を初期化し、新しい`App`インスタンスを生成します。
- **`App::run()`**: アプリケーションのメインループを実行します。イベントの待機、処理、UIの描画を繰り返し行います。
- **`App::handle_event(event: KeyEvent)`**: キーボードイベントを受け取り、そのイベントに応じたアプリケーションの状態変更や処理を行います。
- **`App::insert_char(c: char)`**: 現在のカーソル位置に文字を挿入するテキスト編集機能を提供します。
- **`App::delete_char()`**: 現在のカーソル位置にある文字を削除するテキスト編集機能を提供します。
- **`App::backspace_char()`**: カーソルの前の文字を削除するテキスト編集機能を提供します。
- **`App::move_cursor(direction: CursorDirection)`**: カーソルを上下左右、Home/End、Page Up/Downなどの指定された方向に移動させます。
- **`App::play_mml()`**: 現在編集中のMMLコンテンツを`cat-play-mml`を介して再生します。MMLノートが入力された際に自動的に呼び出されます。
- **`MmlPlayer::install_player()`**: `cat-play-mml`がシステムにインストールされていない場合、GitHubから自動的にダウンロード・ビルドしてインストールする処理を行います。
- **`TemplateManager::next_template()`**: MMLテンプレートを次のものに切り替えます。F2キーが押されたときに呼び出されます。
- **`ui::draw(frame: &mut Frame, app: &App)`**: アプリケーションの現在の状態に基づいて、TUI画面に要素（テキストエリア、ステータスなど）を描画します。

## 関数呼び出し階層ツリー
```
main
├── App::new()
└── App::run()
    ├── event::poll()                                    (イベント取得)
    ├── App::handle_event(event: KeyEvent)               (イベント処理)
    │   ├── App::insert_char(c: char)
    │   ├── App::delete_char()
    │   ├── App::backspace_char()
    │   ├── App::move_cursor(direction: CursorDirection)
    │   ├── App::play_mml()
    │   │   └── MmlPlayer::install_player()                (条件付きで呼び出し)
    │   └── TemplateManager::next_template()
    └── ui::draw(frame: &mut Frame, app: &App)           (UI描画)

---
Generated at: 2025-11-12 07:08:15 JST
