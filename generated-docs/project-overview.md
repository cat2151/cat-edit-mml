Last updated: 2025-11-16

# Project Overview

## プロジェクト概要
- Music Macro Language (MML) のためのシンプルなテキストベースユーザーインターフェース (TUI) エディタです。
- 入力されたMMLを自動で再生し、リアルタイムでの音楽制作を支援します。
- 複数のMMLテンプレートや再生モード切り替え機能を提供し、効率的なMML編集体験を実現します。

## 技術スタック
- フロントエンド: **ratatui** (TUIフレームワーク、ターミナルUIの描画を管理), **tui-textarea** (複数行テキスト入力ウィジェットを提供), **crossterm** (クロスプラットフォームなターミナル操作を抽象化)
- 音楽・オーディオ: **cat-play-mml** (MMLパーサーとオーディオプレイヤー、本プロジェクトから子プロセスとしてMML再生に利用)
- 開発ツール: **Cargo** (Rustの公式ビルドシステムおよびパッケージマネージャー、依存関係管理とビルドを効率化)
- テスト: Rustの組み込みテストフレームワーク (開発時に`cargo test`コマンドで利用)
- ビルドツール: **Cargo** (プロジェクトのビルドプロセスと依存関係解決を管理)
- 言語機能: **Rust** (安全性とパフォーマンスに重点を置いたシステムプログラミング言語)
- 自動化・CI/CD: (特になし)
- 開発標準: (特になし)

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.md
📄 _config.yml
📁 generated-docs/
📁 issue-notes/
  📖 6.md
📁 src/
  📄 app.rs
  📄 event.rs
  📄 lib.rs
  📄 main.rs
  📄 mml.rs
  📄 template.rs
  📄 ui.rs
```

## ファイル詳細説明
- **`.gitignore`**: Gitがバージョン管理の対象外とするファイルやディレクトリを指定し、不要なファイルのコミットを防ぎます。
- **`Cargo.lock`**: プロジェクトが依存するすべてのクレートの正確なバージョンとチェックサムを記録し、再現性のあるビルドを保証します。
- **`Cargo.toml`**: Rustプロジェクトのメタデータ（プロジェクト名、バージョン、作者など）と、依存する外部クレート（ライブラリ）を定義するマニフェストファイルです。
- **`LICENSE`**: プロジェクトのライセンス情報（この場合はMIT License）が記載されており、ソフトウェアの利用条件を定めています。
- **`README.md`**: プロジェクトの概要、機能、インストール方法、使用方法、キーボードショートカットなど、プロジェクトに関する包括的な情報を提供します。
- **`_config.yml`**: GitHub Pagesなどの静的サイトジェネレーターでウェブサイトを公開する際の設定ファイルです。
- **`generated-docs/`**: 自動生成されたドキュメントやレポートなどを格納するためのディレクトリです。
- **`issue-notes/6.md`**: 特定のIssue（#6）に関する詳細なメモや解決策、議論などを記録したファイルです。
- **`src/app.rs`**: TUIアプリケーションの中核となるロジックを実装します。アプリケーションの状態管理、イベント処理、UIの描画指示などを統括します。
- **`src/event.rs`**: ユーザーからのキーボード入力などのイベントを捕捉し、処理するためのロジックを定義します。イベントループの管理やイベントディスパッチを担当します。
- **`src/lib.rs`**: プロジェクトをライブラリとして使用する際に公開されるモジュールや関数を定義します。`main.rs`から共通機能として利用される場合もあります。
- **`src/main.rs`**: プログラムのエントリポイントであり、アプリケーションの初期化、メインループの開始、TUIのセットアップなど、アプリケーション全体の起動処理を担います。
- **`src/mml.rs`**: Music Macro Language (MML) 関連の処理を実装します。MMLのパース、`cat-play-mml`を介したMMLの再生制御、`cat-play-mml`のインストールロジックなどが含まれます。
- **`src/template.rs`**: MMLテンプレートの管理ロジックを実装します。複数のMMLテンプレートの定義、F2キーによるテンプレートの切り替え機能を提供します。
- **`src/ui.rs`**: `ratatui`や`tui-textarea`を用いて、TUIの具体的な描画ロジックを実装します。エディタのテキストエリア、タイトルバー、ステータスバーなどのUI要素の配置と表示を定義します。

## 関数詳細説明
- **`main`関数 (`src/main.rs`で定義されていると想定)**
    - **役割**: アプリケーションのエントリポイント。
    - **引数**: なし
    - **戻り値**: `Result<(), Box<dyn Error>>` (エラーハンドリングのためのResult型)
    - **機能**: ターミナルの初期化、アプリケーションの状態管理を行う`App`構造体のインスタンス化、メインイベントループの開始、終了時のターミナル状態復元を行います。
- **`App::run`関数 (`src/app.rs`で定義されていると想定)**
    - **役割**: アプリケーションのメインイベントループを実行し、TUIを管理します。
    - **引数**: なし（`&mut self`を通じて`App`インスタンスの状態を使用）
    - **戻り値**: `Result<(), Box<dyn Error>>`
    - **機能**: ユーザー入力イベントの待機、イベントに応じたアプリケーション状態の更新、UIの再描画を繰り返します。
- **`App::handle_event`関数 (`src/app.rs`で定義されていると想定)**
    - **役割**: 特定のユーザー入力イベント（キープレスなど）を処理し、アプリケーションの状態を更新します。
    - **引数**: `event: Event` (処理すべきイベント)
    - **戻り値**: `Result<bool, Box<dyn Error>>` (アプリケーション終了を指示するかどうか)
    - **機能**: カーソル移動、テキスト挿入/削除、再生モード切り替え、テンプレート切り替えなどのエディタ操作を実装します。
- **`mml::play_mml`関数 (`src/mml.rs`で定義されていると想定)**
    - **役割**: 指定されたMML文字列を`cat-play-mml`子プロセスを使用して再生します。
    - **引数**: `mml_string: &str`, `mode: PlayMode` (再生するMML文字列と再生モード)
    - **戻り値**: `Result<(), Box<dyn Error>>`
    - **機能**: `cat-play-mml`の子プロセスを起動し、MMLコンテンツを渡して音楽を再生させます。必要に応じて`cat-play-mml`の初回インストールも行います。
- **`template::next_template`関数 (`src/template.rs`で定義されていると想定)**
    - **役割**: MMLテンプレートリストの次のテンプレートに切り替えます。
    - **引数**: `&mut self` (テンプレートの状態を管理する構造体インスタンス)
    - **戻り値**: `&str` (切り替わったテンプレートのMML文字列)
    - **機能**: 内部のインデックスを更新し、現在のテンプレートをリスト内の次のテンプレートに設定してその内容を返します。
- **`ui::draw`関数 (`src/ui.rs`で定義されていると想定)**
    - **役割**: アプリケーションの現在の状態に基づいて、ターミナルユーザーインターフェースを描画します。
    - **引数**: `frame: &mut Frame`, `app: &App` (描画フレームとアプリケーションの状態)
    - **戻り値**: なし
    - **機能**: `tui-textarea`ウィジェットや他の`ratatui`コンポーネントを使用して、エディタのテキスト、タイトルバー、ステータスバーなどのUI要素を画面に表示します。

## 関数呼び出し階層ツリー
```
main
├── App::new() (アプリケーション初期化)
├── Terminal::setup() (ターミナル設定)
├── App::run() (メインイベントループ)
│   ├── (イベント処理ループ)
│   │   ├── Event::poll() (ユーザー入力イベント待機)
│   │   └── App::handle_event(event) (イベントに応じた処理)
│   │       ├── (Textareaウィジェットの操作: テキスト挿入/削除など)
│   │       ├── mml::play_mml(mml_string, play_mode) (MML再生)
│   │       └── template::next_template() (MMLテンプレート切り替え)
│   └── ui::draw(frame, app_state) (UI描画)
│       └── (Textarea::widget() などのUIコンポーネント描画)
└── Terminal::restore() (ターミナル状態復元)

---
Generated at: 2025-11-16 07:06:59 JST
