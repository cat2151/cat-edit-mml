Last updated: 2025-11-10

# Project Overview

## プロジェクト概要
- Rustで構築された、Music Macro Language (MML) 向けのテキストユーザーインターフェース (TUI) エディタです。
- シンタックスハイライト対応のエディタ機能に加え、入力中のMMLを自動再生するプレビュー機能を搭載しています。
- シンプルでミニマムなコマンドライン体験を提供し、MMLの入力と試聴を素早く開始できることを目指しています。

## 技術スタック
- フロントエンド: 
    - **ratatui**: ターミナル上でリッチなユーザーインターフェース（TUI）を構築するためのRustフレームワークです。
    - **tui-textarea**: `ratatui`フレームワーク上で動作する、複数行のテキスト入力・編集機能を提供するウィジェットです。
    - **crossterm**: クロスプラットフォームでターミナルの操作（キー入力、カーソル移動、色の変更など）を可能にするライブラリです。
- 音楽・オーディオ: 
    - **Music Macro Language (MML)**: 楽曲をテキスト形式で記述するための言語です。
    - **cat-play-mml**: 本プロジェクトがMMLの自動再生機能のために子プロセスとして呼び出す外部ツールです。Windows専用で、Nuked-OPMエンジンを利用してMMLをオーディオとして再生します。
- 開発ツール: 
    - **Rust**: 高速でメモリ安全なシステムプログラミング言語であり、本プロジェクトの基盤となっています。
    - **Cargo**: Rustの公式ビルドシステム兼パッケージマネージャーです。プロジェクトのビルド、テスト、依存関係の管理を行います。
- テスト: 
    - **Rustの組み込みテストフレームワーク**: Cargoを通じて実行される、Rust言語に標準で備わっている単体テストおよび結合テストの機能です。
- ビルドツール: 
    - **Cargo**: Rustプロジェクトのコンパイル、依存関係の解決、実行ファイルの生成など、ビルドプロセス全般を管理します。
- 言語機能: 
    - **Rust**: 所有権システムによるメモリ安全性保証、ゼロコスト抽象化、強力な型システムなど、堅牢で高性能なアプリケーション開発を可能にする言語機能を利用しています。
- 自動化・CI/CD: (特記なし。Cargoによるビルド・テストが基本的な自動化プロセスです。)
- 開発標準: (特記なし。Rustの標準的なコーディング規約とツールが利用されていると考えられます。)

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.md
📄 _config.yml
📁 generated-docs/
📁 src/
  📄 app.rs
  📄 event.rs
  📄 lib.rs
  📄 main.rs
  📄 mml.rs
  📄 template.rs
  📄 ui.rs
```

## ファイル詳細説明
- **`.gitignore`**: Gitのバージョン管理システムが追跡しないファイルやディレクトリのパターンを定義します。ビルド生成物や一時ファイルなどが含まれます。
- **`Cargo.lock`**: `Cargo.toml`で定義された依存クレートの、ビルド時に実際に使用された厳密なバージョンを記録します。これにより、環境によらず再現性のあるビルドを保証します。
- **`Cargo.toml`**: Rustプロジェクトのマニフェストファイルです。プロジェクト名、バージョン、著者情報、依存する外部クレート（ライブラリ）などを定義します。
- **`LICENSE`**: 本プロジェクトがMITライセンスで提供されていることを示すライセンス条項が記述されています。
- **`README.md`**: プロジェクトの概要、機能、インストール方法、使用方法、キーボード操作、関連プロジェクトなどの詳細情報を提供する主要なドキュメントです。
- **`_config.yml`**: GitHub Pagesの設定ファイルです。このプロジェクトでは、README.mdをウェブページとして表示するために使用される可能性があります。
- **`generated-docs/`**: プロジェクトのドキュメント（例えば`cargo doc`で生成されるAPIドキュメントなど）が格納される可能性があるディレクトリです。
- **`src/`**: プロジェクトの主要なソースコードが格納されるディレクトリです。
    - **`app.rs`**: アプリケーション全体の状態管理、主要なロジック、イベントループの制御など、アプリケーションの核となる部分を定義します。
    - **`event.rs`**: ユーザーからの入力（キーボードイベントなど）やシステムイベントを処理・管理するモジュールです。
    - **`lib.rs`**: `cat-edit-mml`をライブラリとして利用する場合のエントリポイントとなるファイルです。通常、`main.rs`から呼び出される共通機能やモジュールを公開します。
    - **`main.rs`**: 実行可能アプリケーションのエントリポイントです。プログラムの起動処理やメイン関数が定義されています。
    - **`mml.rs`**: Music Macro Language (MML) 関連の処理を担当するモジュールです。MML文字列の解析、`cat-play-mml`子プロセスの起動とMMLデータの受け渡しなどを行います。
    - **`template.rs`**: 組み込みのMMLテンプレートの定義と管理を行うモジュールです。テンプレートの切り替えロジックや、各テンプレートのMML内容を提供します。
    - **`ui.rs`**: ユーザーインターフェース（TUI）の描画ロジックを担当するモジュールです。`ratatui`クレートを使用して、エディタ画面や各種情報をターミナルに描画します。

## 関数詳細説明
- **`run_app()` (app.rs)**: アプリケーションのメインループを開始し、ユーザーイベントの処理とUIの描画を繰り返し実行します。アプリケーションのライフサイクル全体を管理します。
- **`handle_event()` (app.rs / event.rs)**: ユーザーからのキー入力などのイベントを受け取り、それに応じてアプリケーションの状態を更新したり、特定の操作（テキスト編集、テンプレート切り替え、終了など）を実行したりします。
- **`draw_ui()` (ui.rs)**: 現在のアプリケーションの状態（エディタの内容、カーソル位置など）に基づいて、`ratatui`フレームワークを使ってターミナル画面にエディタのインターフェースを描画します。
- **`edit_text()` (app.rs / tui-textarea)**: エディタ内のテキストに対して、挿入、削除、バックスペース、カーソル移動などの標準的なテキスト編集操作を適用します。
- **`play_mml()` (mml.rs)**: 現在エディタにあるMMLコンテンツを、外部の`cat-play-mml`プロセスに渡して再生を開始します。再生に必要なコマンドの構築と子プロセスの実行を管理します。
- **`cycle_template()` (template.rs / app.rs)**: F2キーが押された際に、利用可能なMMLテンプレートを順番に切り替え、エディタの内容を更新します。
- **`get_current_template_content()` (template.rs)**: 現在選択されているMMLテンプレートの文字列コンテンツを取得します。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした。

---
Generated at: 2025-11-10 08:19:41 JST
